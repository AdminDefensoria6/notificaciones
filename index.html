<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Notificaciones Electrónicas</title>
<style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',sans-serif;}
    body{background-color:#f9fafb;color:#333;}
    #inicio{height:100vh;display:flex;align-items:center;justify-content:center;flex-direction:column;text-align:center;background:#1a2b4c;}
    .contenedor-centrado{background:rgba(255,255,255,0.9);padding:40px;border-radius:12px;box-shadow:0 4px 20px rgba(0,0,0,0.1);}
    h1{font-size:2rem;color:#2c3e50;}
    p.subtitulo{color:#555;margin-bottom:30px;}
    button.btn{padding:12px 30px;background-color:#3498db;color:white;border:none;border-radius:6px;cursor:pointer;font-size:1rem;transition:0.3s;}
    button.btn:hover{background-color:#2980b9;}
    #admin{display:none;padding:20px;max-width:1250px;margin:auto;}
    .header-admin{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;border-bottom:2px solid #ddd;padding-bottom:10px;}
    .filtros{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:15px;margin-bottom:20px;background:white;padding:15px;border-radius:8px;box-shadow:0 2px 5px rgba(0,0,0,0.1);}
    .filtro-grupo label{font-weight:500;margin-bottom:5px;}
    .filtro-grupo input,.filtro-grupo select{width:100%;padding:8px;border:1px solid #ccc;border-radius:4px;}
    table{width:100%;border-collapse:collapse;background:white;border-radius:8px;overflow:hidden;box-shadow:0 2px 5px rgba(0,0,0,0.1);}
    th,td{padding:12px 15px;text-align:left;border-bottom:1px solid #eee;}
    th{background-color:#f4f6f7;}
    tr:hover{background-color:#f1f9ff;}
    .acciones{display:flex;gap:10px;}
    .btn-editar{background-color:#27ae60;color:white;border:none;padding:6px 12px;border-radius:4px;cursor:pointer;}
    .btn-eliminar{background-color:#e74c3c;color:white;border:none;padding:6px 12px;border-radius:4px;cursor:pointer;}
    .badge{padding:6px 10px;border-radius:5px;color:white;font-weight:bold;display:inline-block;text-align:center;min-width:80px;}
    .baja{background-color:#7f8c8d;}
    .media{background-color:#e67e22;}
    .alta{background-color:#e74c3c;}
    .urgente{background-color:#8e44ad;}
    .paginacion{text-align:center;margin-top:15px;}
    .pagina{display:inline-block;padding:6px 12px;margin:0 3px;border:1px solid #ccc;border-radius:4px;cursor:pointer;}
    .pagina.activa{background-color:#3498db;color:white;}
    .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.4);justify-content:center;align-items:center;z-index:999;}
    .modal.activa{display:flex;}
    .modal-contenido{background:white;padding:20px;border-radius:8px;max-width:600px;width:90%;box-shadow:0 5px 15px rgba(0,0,0,0.3);}
    .modal-header{display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid #ddd;margin-bottom:10px;}
    .modal-header h2{font-size:1.3rem;}
    .modal-cerrar{font-size:1.5rem;background:none;border:none;cursor:pointer;color:#999;}
    .form-grupo{margin-bottom:15px;}
    .form-grupo label{display:block;margin-bottom:5px;}
    .form-grupo input,.form-grupo select,.form-grupo textarea{width:100%;padding:8px;border:1px solid #ccc;border-radius:4px;}
    .modal-footer{display:flex;justify-content:flex-end;gap:10px;}
    .prioridad-opciones{display:flex;gap:10px;}
    .prioridad-btn{flex:1;padding:10px;border:none;color:white;border-radius:4px;cursor:pointer;font-weight:600;opacity:0.7;}
    .prioridad-btn.activa{opacity:1;}
    .alerta{position:fixed;bottom:20px;right:20px;background:#2ecc71;color:white;padding:12px 20px;border-radius:8px;box-shadow:0 3px 10px rgba(0,0,0,0.2);}
    .acciones-superiores{display:flex;justify-content:space-between;margin-bottom:15px;}
    .btn-imprimir{background-color:#27ae60;}
    
    /* Alerta de confirmación de eliminación */
    .modal-confirmacion{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);justify-content:center;align-items:center;z-index:1000;}
    .modal-confirmacion.activa{display:flex;}
    .modal-confirmacion-contenido{background:white;padding:25px;border-radius:8px;max-width:450px;width:90%;box-shadow:0 5px 20px rgba(0,0,0,0.3);text-align:center;}
    .modal-confirmacion-header{color:#e74c3c;margin-bottom:15px;}
    .modal-confirmacion-header h2{font-size:1.5rem;margin-bottom:5px;}
    .modal-confirmacion-body{margin-bottom:25px;font-size:1.1rem;color:#555;}
    .modal-confirmacion-footer{display:flex;justify-content:center;gap:15px;}
    .btn-confirmar{background-color:#e74c3c;color:white;padding:10px 25px;border:none;border-radius:6px;cursor:pointer;font-size:1rem;font-weight:600;}
    .btn-cancelar{background-color:#7f8c8d;color:white;padding:10px 25px;border:none;border-radius:6px;cursor:pointer;font-size:1rem;font-weight:600;}
    
    @media print {
        body * { visibility: hidden; }
        #admin, #admin * { visibility: visible; }
        #admin { position: absolute; top: 0; left: 0; width: 100%; }
        .filtros, .paginacion, .acciones, .header-admin button { display: none !important; }
    }
</style>
</head>
<body>

<section id="inicio">
  <div class="contenedor-centrado">
    <h1>Notificaciones Electrónicas</h1>
    <p class="subtitulo">Defensor Oficial Civil y Comercial 6<br>Poder Judicial de Misiones</p>
    <button class="btn" id="btnIngresar">Ingresar</button>
  </div>
</section>

<section id="admin">
  <div class="header-admin">
    <h2>Listado de notificaciones electrónicas</h2>
    <div>
      <button class="btn" id="btnNuevo" style="background-color:#2980b9;">Nuevo Registro</button>
      <button class="btn btn-imprimir" id="btnImprimir" style="background-color:#27ae60;">Imprimir Lista</button>
      <button class="btn" id="btnCerrar" style="background-color:#e74c3c;">Cerrar</button>
    </div>
  </div>

  <div class="acciones-superiores">
    <div id="contadorRegistros">Total de registros: 0</div>
  </div>

  <div class="filtros">
    <div class="filtro-grupo"><label>Buscar</label><input type="text" id="filtroTexto" placeholder="Expediente o carátula"></div>
    <div class="filtro-grupo"><label>Fecha</label><input type="date" id="filtroFecha"></div>
    <div class="filtro-grupo"><label>Responsable</label><select id="filtroResponsable"></select></div>
    <div class="filtro-grupo"><label>Juzgado</label><select id="filtroJuzgado"></select></div>
    <div class="filtro-grupo"><label>Tipo</label><select id="filtroTipo">
      <option value="">Todos</option>
      <option>Citación</option>
      <option>Resolución</option>
      <option>Sentencia</option>
    </select></div>
    <div class="filtro-grupo"><label>Prioridad</label><select id="filtroPrioridad">
      <option value="">Todas</option>
      <option>Baja</option>
      <option>Media</option>
      <option>Alta</option>
      <option>Urgente</option>
    </select></div>
  </div>

  <table>
    <thead>
      <tr>
        <th>Fecha</th>
        <th>Expediente</th>
        <th>Carátula</th>
        <th>Juzgado</th>
        <th>Responsable</th>
        <th>Tipo</th>
        <th>Prioridad</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody id="tablaCuerpo"></tbody>
  </table>
  <div class="paginacion" id="paginacion"></div>
</section>

<div class="modal" id="modalRegistro">
  <div class="modal-contenido">
    <div class="modal-header">
      <h2 id="modalTitulo">Nuevo Registro</h2>
      <button class="modal-cerrar" id="modalCerrar">&times;</button>
    </div>
    <form id="formRegistro">
      <div class="form-grupo"><label>Fecha de notificación</label><input type="date" id="fechaNotificacion" required></div>
      <div class="form-grupo"><label>Expediente</label><input type="text" id="expediente" required></div>
      <div class="form-grupo"><label>Carátula</label><textarea id="caratula" required></textarea></div>
      <div class="form-grupo"><label>Juzgado</label><select id="juzgado" required></select></div>
      <div class="form-grupo"><label>Responsable</label><select id="responsable" required></select></div>
      <div class="form-grupo"><label>Tipo</label><select id="tipoNotificacion" required>
        <option value="">Seleccione...</option><option>Citación</option><option>Resolución</option><option>Sentencia</option></select></div>
      <div class="form-grupo"><label>Prioridad</label>
        <div class="prioridad-opciones" id="grupoPrioridad">
          <button type="button" class="prioridad-btn baja" style="background-color:#7f8c8d">Baja</button>
          <button type="button" class="prioridad-btn media" style="background-color:#e67e22">Media</button>
          <button type="button" class="prioridad-btn alta" style="background-color:#e74c3c">Alta</button>
          <button type="button" class="prioridad-btn urgente" style="background-color:#8e44ad">Urgente</button>
        </div>
        <input type="hidden" id="prioridadNotificacion" required>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn" id="btnCancelar" style="background-color:#e74c3c;">Cancelar</button>
        <button type="submit" class="btn" style="background-color:#3498db;">Guardar</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal de confirmación de eliminación -->
<div class="modal-confirmacion" id="modalConfirmacion">
  <div class="modal-confirmacion-contenido">
    <div class="modal-confirmacion-header">
      <h2>⚠️ Eliminar Registro</h2>
    </div>
    <div class="modal-confirmacion-body">
      <p>¿Está seguro de que desea eliminar este registro?</p>
      <p><strong>Esta acción no se puede deshacer.</strong></p>
    </div>
    <div class="modal-confirmacion-footer">
      <button class="btn-cancelar" id="btnCancelarEliminacion">Cancelar</button>
      <button class="btn-confirmar" id="btnConfirmarEliminacion">Eliminar</button>
    </div>
  </div>
</div>

<div id="alerta" class="alerta" style="display:none;"></div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { 
  getFirestore, 
  collection, 
  addDoc, 
  getDocs, 
  updateDoc, 
  deleteDoc, 
  doc 
} from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDrzUT1defyEUNA7apAlyP6mtivpNVrkqA",
  authDomain: "notificaciones-electronicas6.firebaseapp.com",
  projectId: "notificaciones-electronicas6",
  storageBucket: "notificaciones-electronicas6.firebasestorage.app",
  messagingSenderId: "518189859271",
  appId: "1:518189859271:web:eecdd6b469f1611b2b99e2"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const responsables = ["Bazante Nadia Romina","Cardozo Maria Raquel","Cedron Noelia Aurora","Corrales Alicia Mariela","Escobar Monica Graciela","Fioravante Romulo","Gonzalez Alberto Misael","Gonzalez Juan Jose","Gudiño Natalia Esther","Magnani Enzo Luciano","Pablos Patricia","Palacios Ana Gabriela","Ramos Marcelo Gustavo","Riveros Patricia Soledad","Sosa Rita Cecilia"];

const juzgados = {
  "Administrativo": ["CEJUME - Posadas","DEUT Defensorias - Posadas","Legajo Defensoria Civil y Comercial N° 6"],
  "Civil": ["Juzgado Civil y Comercial N° 1 - Posadas","Juzgado Civil y Comercial N° 2 - Posadas","Juzgado Civil y Comercial N° 3 - Posadas","Juzgado Civil y Comercial N° 4 - Posadas","Juzgado Civil y Comercial N° 5 - Posadas","Juzgado Civil y Comercial N° 6 - Posadas","Juzgado Civil y Comercial N° 7 - Posadas","Juzgado Civil y Comercial N° 8 - Posadas","... Civil Comercial Laboral Familia y Violencia Fliar- Apostoles"],
  "Penal": ["Juzgado de Instrucción N° 1 - Posadas","Juzgado de Instrucción N° 2 - Posadas","Juzgado de Instrucción N° 3 - Posadas","Juzgado de Instrucción N° 6 - Posadas","Juzgado de Instrucción N° 7 - Posadas","Juzgado Correccional y de Menores N° 1 - Posadas","Juzgado Correccional y de Menores N° 2 - Posadas","Tribunal Penal N° 1 - Posadas","Tribunal Penal N° 2 - Posadas"],
  "Laboral": ["Juzgado Laboral N° 1 - Posadas","Juzgado Laboral N° 2 - Posadas","Juzgado Laboral N° 3 - Posadas","Juzgado Laboral N° 4 - Posadas"],
  "Familia": ["Juzgado de Familia N° 1 - Posadas","Juzgado de Familia N° 2 - Posadas","Juzgado de Familia N° 3 - Posadas","Juzgado Familia y VF Garupa","... Civil Comercial Laboral Familia y Violencia Fliar- Apostoles"],
  "Violencia Familiar": ["Juzgado de Violencia Familiar N° 1 - Posadas","Juzgado de Violencia Familiar N° 2 - Posadas","Juzgado F y Violencia Familiar Garupa","... Civil Comercial Laboral Familia y Violencia Fliar- Apostoles"],
  "Paz": ["Juzgado de Paz Civil Comercial N° 1 - Posadas","Juzgado de Paz Civil Comercial N° 2 - Posadas","Juzgado de Paz de Itaembe Mini - Posadas","Juzgado de Paz de Itaembe Guazu - Posadas","Juzgado de Paz de Villa Cabello - Posadas","Juzgado de Paz de Garupa","Juzgado de Paz de Fatima - Garupa","Juzgado de Paz de Apostoles","Juzgado de Paz de Candelaria"]
};

// Variables globales
let notificaciones = [];
let notificacionesFiltradas = [];
let paginaActual = 1;
let editandoId = null;
let idParaEliminar = null;
const registrosPorPagina = 10;

// Elementos DOM
const inicio = document.getElementById('inicio');
const admin = document.getElementById('admin');
const modal = document.getElementById('modalRegistro');
const modalConfirmacion = document.getElementById('modalConfirmacion');
const tablaCuerpo = document.getElementById('tablaCuerpo');
const paginacion = document.getElementById('paginacion');
const alerta = document.getElementById('alerta');
const contadorRegistros = document.getElementById('contadorRegistros');

// Event Listeners
document.getElementById('btnIngresar').onclick = () => {
  inicio.style.display = 'none';
  admin.style.display = 'block';
  cargarDatos();
};

document.getElementById('btnCerrar').onclick = () => {
  admin.style.display = 'none';
  inicio.style.display = 'flex';
};

document.getElementById('btnNuevo').onclick = () => abrirModal();
document.getElementById('modalCerrar').onclick = cerrarModal;
document.getElementById('btnCancelar').onclick = cerrarModal;
document.getElementById('formRegistro').onsubmit = guardarRegistro;
document.getElementById('btnImprimir').onclick = () => window.print();

// Event listeners para el modal de confirmación
document.getElementById('btnCancelarEliminacion').onclick = cerrarModalConfirmacion;
document.getElementById('btnConfirmarEliminacion').onclick = confirmarEliminacion;

// Filtros
document.getElementById('filtroTexto').addEventListener('input', aplicarFiltros);
document.getElementById('filtroFecha').addEventListener('change', aplicarFiltros);
document.getElementById('filtroResponsable').addEventListener('change', aplicarFiltros);
document.getElementById('filtroJuzgado').addEventListener('change', aplicarFiltros);
document.getElementById('filtroTipo').addEventListener('change', aplicarFiltros);
document.getElementById('filtroPrioridad').addEventListener('change', aplicarFiltros);

// Configurar botones de prioridad
document.querySelectorAll('.prioridad-btn').forEach(boton => {
  boton.onclick = () => {
    document.querySelectorAll('.prioridad-btn').forEach(b => b.classList.remove('activa'));
    boton.classList.add('activa');
    document.getElementById('prioridadNotificacion').value = boton.textContent;
  };
});

// Funciones
function cargarListas() {
  const juzgadoSelect = document.getElementById('juzgado');
  const juzgadoFiltroSelect = document.getElementById('filtroJuzgado');
  const responsableSelect = document.getElementById('responsable');
  const responsableFiltroSelect = document.getElementById('filtroResponsable');
  
  // Limpiar selects
  juzgadoSelect.innerHTML = '<option value="">Seleccione...</option>';
  juzgadoFiltroSelect.innerHTML = '<option value="">Todos</option>';
  responsableSelect.innerHTML = '<option value="">Seleccione...</option>';
  responsableFiltroSelect.innerHTML = '<option value="">Todos</option>';
  
  // Cargar juzgados
  for(let categoria in juzgados) {
    const grupo = document.createElement('optgroup');
    grupo.label = categoria;
    
    juzgados[categoria].forEach(juzgado => {
      const opcion = document.createElement('option');
      opcion.value = juzgado;
      opcion.textContent = juzgado;
      grupo.appendChild(opcion);
      
      // También para el filtro
      const opcionFiltro = document.createElement('option');
      opcionFiltro.value = juzgado;
      opcionFiltro.textContent = juzgado;
      juzgadoFiltroSelect.appendChild(opcionFiltro);
    });
    
    juzgadoSelect.appendChild(grupo);
  }
  
  // Cargar responsables
  responsables.forEach(responsable => {
    const opcion = document.createElement('option');
    opcion.value = responsable;
    opcion.textContent = responsable;
    responsableSelect.appendChild(opcion);
    
    const opcionFiltro = document.createElement('option');
    opcionFiltro.value = responsable;
    opcionFiltro.textContent = responsable;
    responsableFiltroSelect.appendChild(opcionFiltro);
  });
}

function abrirModal(notificacion = null) {
  modal.classList.add('activa');
  document.getElementById('formRegistro').reset();
  document.querySelectorAll('.prioridad-btn').forEach(b => b.classList.remove('activa'));
  
  if (notificacion) {
    // Modo edición
    document.getElementById('modalTitulo').textContent = 'Editar Registro';
    document.getElementById('fechaNotificacion').value = notificacion.fecha;
    document.getElementById('expediente').value = notificacion.expediente;
    document.getElementById('caratula').value = notificacion.caratula;
    document.getElementById('juzgado').value = notificacion.juzgado;
    document.getElementById('responsable').value = notificacion.responsable;
    document.getElementById('tipoNotificacion').value = notificacion.tipo;
    
    // Establecer prioridad
    const prioridad = notificacion.prioridad.toLowerCase();
    const botonPrioridad = document.querySelector(`.prioridad-btn.${prioridad}`);
    if (botonPrioridad) {
      botonPrioridad.classList.add('activa');
      document.getElementById('prioridadNotificacion').value = notificacion.prioridad;
    }
    
    editandoId = notificacion.id;
  } else {
    // Modo nuevo
    document.getElementById('modalTitulo').textContent = 'Nuevo Registro';
    editandoId = null;
  }
}

function cerrarModal() {
  modal.classList.remove('activa');
  editandoId = null;
}

// Funciones para el modal de confirmación de eliminación
function abrirModalConfirmacion(id) {
  idParaEliminar = id;
  modalConfirmacion.classList.add('activa');
}

function cerrarModalConfirmacion() {
  modalConfirmacion.classList.remove('activa');
  idParaEliminar = null;
}

async function confirmarEliminacion() {
  if (idParaEliminar) {
    try {
      await deleteDoc(doc(db, 'causas', idParaEliminar));
      mostrarAlerta('Registro eliminado correctamente');
      cargarDatos();
    } catch(error) {
      console.error("Error al eliminar:", error);
      mostrarAlerta('Error al eliminar el registro: ' + error.message, '#e74c3c');
    }
    cerrarModalConfirmacion();
  }
}

async function guardarRegistro(e) {
  e.preventDefault();
  
  const prioridad = document.getElementById('prioridadNotificacion').value;
  if(!prioridad) {
    mostrarAlerta('Por favor seleccione una prioridad', '#e74c3c');
    return;
  }
  
  const nuevaNotificacion = {
    fecha: document.getElementById('fechaNotificacion').value,
    expediente: document.getElementById('expediente').value,
    caratula: document.getElementById('caratula').value,
    juzgado: document.getElementById('juzgado').value,
    responsable: document.getElementById('responsable').value,
    tipo: document.getElementById('tipoNotificacion').value,
    prioridad: prioridad
  };
  
  try {
    if (editandoId) {
      // Actualizar registro existente
      await updateDoc(doc(db, 'causas', editandoId), nuevaNotificacion);
      mostrarAlerta('Registro actualizado correctamente');
    } else {
      // Crear nuevo registro
      await addDoc(collection(db, 'causas'), nuevaNotificacion);
      mostrarAlerta('Registro guardado correctamente');
    }
    
    cerrarModal();
    cargarDatos();
  } catch(error) {
    console.error("Error al guardar:", error);
    mostrarAlerta('Error al guardar el registro: ' + error.message, '#e74c3c');
  }
}

// Funciones globales para editar y eliminar
window.editarRegistro = function(id) {
  const notificacion = notificaciones.find(n => n.id === id);
  if (notificacion) {
    abrirModal(notificacion);
  }
};

window.eliminarRegistro = function(id) {
  abrirModalConfirmacion(id);
};

async function cargarDatos() {
  try {
    tablaCuerpo.innerHTML = '<tr><td colspan="8" style="text-align:center;">Cargando datos...</td></tr>';
    
    const querySnapshot = await getDocs(collection(db, 'causas'));
    notificaciones = querySnapshot.docs.map(d => ({id: d.id, ...d.data()}));
    
    // Ordenar por fecha (más recientes primero)
    notificaciones.sort((a, b) => new Date(b.fecha) - new Date(a.fecha));
    
    aplicarFiltros();
  } catch(error) {
    console.error("Error al cargar datos:", error);
    mostrarAlerta('Error al cargar los datos: ' + error.message, '#e74c3c');
    tablaCuerpo.innerHTML = '<tr><td colspan="8" style="text-align:center;">Error al cargar datos. Verifica la conexión.</td></tr>';
  }
}

function aplicarFiltros() {
  const texto = document.getElementById('filtroTexto').value.toLowerCase();
  const fecha = document.getElementById('filtroFecha').value;
  const responsable = document.getElementById('filtroResponsable').value;
  const juzgado = document.getElementById('filtroJuzgado').value;
  const tipo = document.getElementById('filtroTipo').value;
  const prioridad = document.getElementById('filtroPrioridad').value;
  
  notificacionesFiltradas = notificaciones.filter(notif => {
    return (
      (texto === '' || 
        (notif.expediente && notif.expediente.toLowerCase().includes(texto)) || 
        (notif.caratula && notif.caratula.toLowerCase().includes(texto))) &&
      (fecha === '' || notif.fecha === fecha) &&
      (responsable === '' || notif.responsable === responsable) &&
      (juzgado === '' || notif.juzgado === juzgado) &&
      (tipo === '' || notif.tipo === tipo) &&
      (prioridad === '' || notif.prioridad === prioridad)
    );
  });
  
  contadorRegistros.textContent = `Total de registros: ${notificacionesFiltradas.length}`;
  paginaActual = 1;
  renderTabla();
}

function renderTabla() {
  const inicio = (paginaActual - 1) * registrosPorPagina;
  const fin = inicio + registrosPorPagina;
  const datosPagina = notificacionesFiltradas.slice(inicio, fin);
  
  if(datosPagina.length === 0) {
    tablaCuerpo.innerHTML = '<tr><td colspan="8" style="text-align:center;">No hay registros que coincidan con los filtros.</td></tr>';
  } else {
    tablaCuerpo.innerHTML = datosPagina.map(notif => `
      <tr>
        <td>${formatearFecha(notif.fecha)}</td>
        <td>${notif.expediente || ''}</td>
        <td>${notif.caratula || ''}</td>
        <td>${notif.juzgado || ''}</td>
        <td>${notif.responsable || ''}</td>
        <td>${notif.tipo || ''}</td>
        <td><span class="badge ${(notif.prioridad || '').toLowerCase()}">${notif.prioridad || ''}</span></td>
        <td class="acciones">
          <button class="btn-editar" onclick="editarRegistro('${notif.id}')">Editar</button>
          <button class="btn-eliminar" onclick="eliminarRegistro('${notif.id}')">Eliminar</button>
        </td>
      </tr>
    `).join('');
  }
  
  renderPaginacion();
}

function formatearFecha(fechaString) {
  if(!fechaString) return '';
  const fecha = new Date(fechaString);
  if(isNaN(fecha.getTime())) return fechaString;
  return fecha.toLocaleDateString('es-AR');
}

function renderPaginacion() {
  const totalPaginas = Math.ceil(notificacionesFiltradas.length / registrosPorPagina);
  paginacion.innerHTML = '';
  
  for(let i = 1; i <= totalPaginas; i++) {
    const pagina = document.createElement('span');
    pagina.textContent = i;
    pagina.className = 'pagina' + (i === paginaActual ? ' activa' : '');
    pagina.onclick = () => {
      paginaActual = i;
      renderTabla();
    };
    paginacion.appendChild(pagina);
  }
}

function mostrarAlerta(mensaje, color = '#2ecc71') {
  alerta.textContent = mensaje;
  alerta.style.backgroundColor = color;
  alerta.style.display = 'block';
  setTimeout(() => {
    alerta.style.display = 'none';
  }, 3000);
}

// Inicializar
cargarListas();
</script>
</body>
</html>
